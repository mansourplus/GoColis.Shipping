Ü"
hC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Authentication\AuthenticationEndPoints.cs
	namespace

 	
GoColis


 
.

 
Shipping

 
.

 
Api

 
.

 
Authentication

 -
;

- .
public 
static 
class 
LoginEndPoints "
{ 
public 

static 
void &
MapAuthenticationEndPoints 1
(1 2
this2 6
WebApplication7 E
appF I
)I J
{ 
app 
. 
MapPost 
( 
$str !
,! "
async 
( 
LoginDto 
request #
,# $
	IMediator% .
	_mediator/ 8
,8 9
ILogger: A
<A B
LoginCommandB N
>N O
_loggerP W
,W X
IMapperY `
_mappera h
)h i
=>j l
{ 
var 
command 
= 
_mapper %
.% &
Map& )
<) *
LoginCommand* 6
>6 7
(7 8
request8 ?
)? @
;@ A
var 
result 
= 
	_mediator &
.& '
Send' +
(+ ,
command, 3
)3 4
;4 5
return 
await 
result #
.# $
Match$ )
() *
success 
=> 
Results &
.& '
Ok' )
() *
success* 1
)1 2
,2 3
failed 
=> 
failed $
.$ %
ToResult% -
(- .
_logger. 5
)5 6
) 
; 
} 
) 
; 
app 
. 
MapPost 
( 
$str "
," #
async 
( 
	IMediator 
	_mediator %
,% &
ILogger' .
<. /
LogoutCommand/ <
>< =
_logger> E
)E F
=>G I
{   
var!! 
result!! 
=!! 
	_mediator!! %
.!!% &
Send!!& *
(!!* +
new!!+ .
LogoutCommand!!/ <
(!!< =
)!!= >
)!!> ?
;!!? @
return"" 
await"" 
result"" "
.""" #
Match""# (
(""( )
success## 
=>## 
Results## %
.##% &
Ok##& (
(##( )
)##) *
,##* +
failed$$ 
=>$$ 
failed$$ #
.$$# $
ToResult$$$ ,
($$, -
_logger$$- 4
)$$4 5
)%% 
;%% 
}&& 
)&& 
;&& 
app(( 
.(( 
MapPost(( 
((( 
$str(( $
,(($ %
async)) 
()) 
RegisterDto)) 
request)) &
,))& '
	IMediator))( 1
	_mediator))2 ;
,)); <
ILogger))= D
<))D E
LoginCommand))E Q
>))Q R
_logger))S Z
,))Z [
IMapper))\ c
_mapper))d k
)))k l
=>))m o
{** 
var++ 
command++ 
=++ 
_mapper++ %
.++% &
Map++& )
<++) *
RegisterCommand++* 9
>++9 :
(++: ;
request++; B
)++B C
;++C D
var-- 
result-- 
=-- 
	_mediator-- &
.--& '
Send--' +
(--+ ,
command--, 3
)--3 4
;--4 5
return// 
await// 
result// #
.//# $
Match//$ )
(//) *
success00 
=>00 
Results00 &
.00& '
Created00' .
(00. /
$str00/ <
,00< =
success00> E
)00E F
,00F G
failed11 
=>11 
failed11 $
.11$ %
ToResult11% -
(11- .
_logger11. 5
)115 6
)22 
;22 
}44 
)44 
;44 
}55 
}66 ˛#
xC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Authentication\Handlers\PermissionAuthorizationHandler.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Authentication -
.- .
Handlers. 6
;6 7
public 
class *
PermissionAuthorizationHandler +
:, - 
AuthorizationHandler. B
<B C!
PermissionRequirementC X
>X Y
{ 
	protected		 
override		 
async		 
Task		 !"
HandleRequirementAsync		" 8
(		8 9'
AuthorizationHandlerContext		9 T
context		U \
,		\ ]!
PermissionRequirement		^ s
requirement		t 
)			 Ä
{

 
if 

(
 
context 
. 
Resource 
is 
not "
HttpContext# .
httpctx/ 6
)6 7
{ 	
context 
. 
Fail 
( 
new &
AuthorizationFailureReason 7
(7 8
this8 <
,< =
$str> M
)M N
)N O
;O P
return 
; 
} 	
var 
endpoint 
= 
httpctx 
. 
GetEndpoint *
(* +
)+ ,
!, -
;- .
var 
tags 
= 
endpoint 
. 
Metadata $
.$ %
OfType% +
<+ ,
TagsAttribute, 9
>9 :
(: ;
); <
. 

SelectMany 
( 
x 
=> 
x 
. 
Tags #
)# $
;$ %
if 

(
 
tags 
is 
null 
|| 
! 
tags  
.  !
Any! $
($ %
)% &
)& '
{ 	
context 
. 
Succeed 
( 
requirement '
)' (
;( )
return 
; 
} 	
using 
var 
scop 
= 
httpctx  
.  !
RequestServices! 0
.0 1
CreateScope1 <
(< =
)= >
;> ?
var !
_permissionRepository !
=" #
scop$ (
.( )
ServiceProvider) 8
.8 9
GetRequiredService9 K
<K L!
IPermissionRepositoryL a
>a b
(b c
)c d
;d e
var   
userid   
=   
httpctx   
.   
User   !
.  ! "
FindFirstValue  " 0
(  0 1

ClaimTypes  1 ;
.  ; <
NameIdentifier  < J
)  J K
!  K L
;  L M
if"" 

(""
 
userid"" 
is"" 
null"" 
)"" 
{## 	
context$$ 
.$$ 
Fail$$ 
($$ 
new$$ &
AuthorizationFailureReason$$ 7
($$7 8
this$$8 <
,$$< =
$str$$> M
)$$M N
)$$N O
;$$O P
return%% 
;%% 
}&& 	
var(( 

permission(( 
=(( 
await(( !
_permissionRepository(( 4
.((4 5
GetUserPermission((5 F
(((F G
new((G J
Guid((K O
(((O P
userid((P V
)((V W
)((W X
;((X Y
if** 

(**
 
tags** 
.** 
Any** 
(** 
x** 
=>** 

permission** "
.**" #
Any**# &
(**& '
p**' (
=>**( *
p*** +
.**+ ,
Name**, 0
==**1 3
x**4 5
)**5 6
)**6 7
)**7 8
{++ 	
context,, 
.,, 
Succeed,, 
(,, 
requirement,, '
),,' (
;,,( )
return-- 
;-- 
}.. 	
context00 
.00 
Fail00 
(00 
new00 &
AuthorizationFailureReason00 3
(003 4
this004 8
,008 9
$str00: I
)00I J
)00J K
;00K L
return11 
;11 
}33 
}44 ◊
oC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Authentication\Handlers\PermissionRequirement.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Authentication -
.- .
Handlers. 6
;6 7
public 
class !
PermissionRequirement "
:# $%
IAuthorizationRequirement% >
{ 
} ∑
YC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Authentication\LoginDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Authentication -
;- .
public 
record 
LoginDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
}		 ﬂ
\C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Authentication\RegisterDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Authentication -
.- .
Login. 3
;3 4
public 
record 
RegisterDto 
{ 
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Phone 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public		 

string		 
StreetNumber		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
=		- .
string		/ 5
.		5 6
Empty		6 ;
;		; <
public

 

string

 
Street

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
=

' (
string

) /
.

/ 0
Empty

0 5
;

5 6
public 

string 
AddressLine1 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
AddressLine2 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
City 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
ZipCode 
{ 
get 
;  
set! $
;$ %
}& '
=( )
string* 0
.0 1
Empty1 6
;6 7
public 

string 
Country 
{ 
get 
;  
set! $
;$ %
}& '
=( )
string* 0
.0 1
Empty1 6
;6 7
public 

decimal 
Latitude 
{ 
get !
;! "
set# &
;& '
}( )
public 

decimal 
	Longitude 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
ConfirmPassword !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
string2 8
.8 9
Empty9 >
;> ?
public 

string 
Role 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
} ïD
\C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Common\DependencyInjection.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Common %
;% &
public 
static 
class 
DependencyInjection '
{ 
public 

static 
void 
AddAuth 
( 
this #
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 
var 

jwtOptions 
= 
new 

JwtOptions '
(' (
)( )
;) *
Configuration 
. 
Bind 
( 
nameof !
(! "

JwtOptions" ,
), -
,- .

jwtOptions. 8
)8 9
;9 :
services 
. 
AddSingleton 
( 
Options %
.% &
Create& ,
(, -

jwtOptions- 7
)7 8
)8 9
;9 :
services 
. 
AddSingleton 
< !
IAuthorizationHandler 3
,3 4*
PermissionAuthorizationHandler4 R
>R S
(S T
)T U
;U V
services 
. 
AddIdentity 
< 
User !
,! "
Role# '
>' (
(( )
)) *
.   
AddUserStore   
<   
	UserStore   #
<  # $
User  $ (
,  ( )
Role  * .
,  . /
DatabaseContext  0 ?
,  ? @
Guid  A E
,  E F
	UserClaim  G P
,  P Q
UserRole  R Z
,  Z [
	UserLogin  \ e
,  e f
	UserToken  g p
,  p q
	RoleClaim  r {
>  { |
>  | }
(  } ~
)  ~ 
.!! 
AddRoleStore!! 
<!! 
	RoleStore!! #
<!!# $
Role!!$ (
,!!( )
DatabaseContext!!* 9
,!!9 :
Guid!!; ?
,!!? @
UserRole!!A I
,!!I J
	RoleClaim!!K T
>!!T U
>!!U V
(!!V W
)!!W X
."" $
AddEntityFrameworkStores"" %
<""% &
DatabaseContext""& 5
>""5 6
(""6 7
)""7 8
.## $
AddDefaultTokenProviders## %
(##% &
)##& '
;##' (
services%% 
.%% 
AddAuthorization%% !
(%%! "
options%%" )
=>%%* ,
{&& 	
options'' 
.'' 
	AddPolicy'' 
('' 
$str'' *
,''* +
pp'', .
=>''/ 1
{(( 
pp)) 
.)) $
RequireAuthenticatedUser)) +
())+ ,
))), -
.** $
AddAuthenticationSchemes** )
(**) *
JwtBearerDefaults*** ;
.**; < 
AuthenticationScheme**< P
)**P Q
.++ 
AddRequirements++  
(++  !
new++! $!
PermissionRequirement++% :
(++: ;
)++; <
)++< =
;++= >
},, 
),, 
;,, 
}-- 	
)--	 

;--
 
services// 
.// 
AddAuthentication// "
(//" #
options//# *
=>//+ -
{00 	
options11 
.11 %
DefaultAuthenticateScheme11 -
=11. /
JwtBearerDefaults110 A
.11A B 
AuthenticationScheme11B V
;11V W
options22 
.22 "
DefaultChallengeScheme22 *
=22+ ,
JwtBearerDefaults22- >
.22> ? 
AuthenticationScheme22? S
;22S T
options33 
.33 
DefaultScheme33 !
=33" #
JwtBearerDefaults33$ 5
.335 6 
AuthenticationScheme336 J
;33J K
}44 	
)44	 

.55 
AddJwtBearer55 
(55 
options55 
=>55 
{66 
options77 
.77 
	SaveToken77 
=77 
true77 #
;77# $
options88 
.88 %
TokenValidationParameters88 ,
=88- .
new88/ 2%
TokenValidationParameters883 L
(88L M
)88M N
{99 
ValidateIssuer:: 
=:: 
true::  $
,::$ %
ValidateAudience;; 
=;;  !
true;;" &
,;;& '$
ValidateIssuerSigningKey<< '
=<<( )
true<<* .
,<<. /
ValidateLifetime== 
===  !
true==" &
,==& '
ValidAudiences>> 
=>> 

jwtOptions>>  *
.>>* +
ValidAudiences>>+ 9
,>>9 :
ValidIssuer?? 
=?? 

jwtOptions?? '
.??' (
ValidIssuer??( 3
,??3 4
IssuerSigningKey@@ 
=@@  !
new@@" % 
SymmetricSecurityKey@@& :
(@@: ;
Encoding@@; C
.@@C D
UTF8@@D H
.@@H I
GetBytes@@I Q
(@@Q R

jwtOptions@@R \
.@@\ ]
Secret@@] c
)@@c d
)@@d e
,@@e f
}CC 
;CC 
}DD 
)DD 	
;DD	 

}EE 
publicHH 

staticHH 
IServiceCollectionHH $#
AddSwaggerDocumentationHH% <
(HH< =
thisHH= A
IServiceCollectionHHB T
servicesHHU ]
)HH] ^
{II 
servicesJJ 
.JJ #
AddEndpointsApiExplorerJJ (
(JJ( )
)JJ) *
;JJ* +
servicesKK 
.KK 
AddSwaggerGenKK 
(KK 
configKK %
=>KK& (
{LL 	
configNN 
.NN !
AddSecurityDefinitionNN (
(NN( )
$strNN) 1
,NN1 2
newNN3 6!
OpenApiSecuritySchemeNN7 L
{OO 
DescriptionPP 
=PP 
$strPP 1
,PP1 2
NameQQ 
=QQ 
$strQQ &
,QQ& '
InRR 
=RR 
ParameterLocationRR &
.RR& '
HeaderRR' -
,RR- .
TypeSS 
=SS 
SecuritySchemeTypeSS )
.SS) *
HttpSS* .
,SS. /
SchemeTT 
=TT 
$strTT !
,TT! "
BearerFormatUU 
=UU 
$strUU $
}VV 
)VV 
;VV 
configXX 
.XX "
AddSecurityRequirementXX )
(XX) *
newXX* -&
OpenApiSecurityRequirementXX. H
(XXH I
)XXI J
{YY 
{ZZ 
new[[ !
OpenApiSecurityScheme[[ -
{\\ 
	Reference]] !
=]]" #
new]]$ '
OpenApiReference]]( 8
{^^ 
Type__  
=__! "
ReferenceType__# 0
.__0 1
SecurityScheme__1 ?
,__? @
Idbb 
=bb  
$strbb! )
}cc 
}ee 
,ee 
newff 
Listff 
<ff 
stringff #
>ff# $
(ff$ %
)ff% &
}gg 
}hh 
)hh 
;hh 
}jj 	
)jj	 

;jj
 
returnkk 
serviceskk 
;kk 
}ll 
publicnn 

staticnn 
IApplicationBuildernn %#
UseSwaggerDocumentationnn& =
(nn= >
thisnn> B
IApplicationBuildernnC V
appnnW Z
)nnZ [
{oo 
apppp 
.pp 

UseSwaggerpp 
(pp 
)pp 
;pp 
appqq 
.qq 
UseSwaggerUIqq 
(qq 
)qq 
;qq 
returnss 
appss 
;ss 
}tt 
publicvv 

staticvv 
WebApplicationvv  
AddEndPointsvv! -
(vv- .
thisvv. 2
WebApplicationvv3 A
appvvB E
)vvE F
{ww 
appxx 
.xx "
MapRelayPointEndPointsxx "
(xx" #
)xx# $
;xx$ %
appyy 
.yy  
MapShipmentEndPointsyy  
(yy  !
)yy! "
;yy" #
appzz 
.zz &
MapAuthenticationEndPointszz &
(zz& '
)zz' (
;zz( )
return|| 
app|| 
;|| 
}}} 
} ¸
VC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Common\Dtos\ErrorDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
Common %
.% &
Dtos& *
{ 
public 

record 
ErrorDto 
( 
string !
Message" )
)) *
{ 
public 
static 
ErrorDto 
ToDto $
($ %
Error% *
error+ 0
)0 1
=>2 4
new5 8
ErrorDto9 A
(A B
errorB G
.G H
DescriptionH S
)S T
;T U
} 
}		 ˚
]C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Extensions\ResultExtensions.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 

Extensions )
;) *
public 
static 
class 
ResultExtensions $
{ 
internal 
static 
IResult 
ToResult $
($ %
this% )
Error* /
error0 5
,5 6
ILogger7 >
?> ?
logger@ F
=F G
nullG K
)K L
{		 
var

 
dto

 
=

 
ErrorDto

 
.

 
ToDto

  
(

  !
error

! &
!

& '
)

' (
;

( )
switch 
( 
error 
. 
Type 
) 
{ 	
case 
	ErrorType 
. 
NotFound #
:# $
return 
Results 
. 
NotFound '
(' (
dto( +
)+ ,
;, -
case 
	ErrorType 
. 

Validation %
:% &
case 
	ErrorType 
. 
Conflict #
:# $
return 
Results 
. 

BadRequest )
() *
dto* -
)- .
;. /
default 
: 
var 
msg 
= 
$" 
{ 
error "
." #
Code# '
}' (
$str( *
{* +
error+ 0
.0 1
Description1 <
}< =
"= >
;> ?
logger 
? 
. 
LogError  
(  !
msg! $
)$ %
;% &
return 
Results 
. 
Problem &
(& '
detail' -
:- .
error/ 4
.4 5
Description5 @
,@ A

statusCodeB L
:L M
$numN Q
)Q R
;R S
} 	
} 
} ›
eC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Extensions\WebApplicationExtensions.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 

Extensions )
;) *
public 
static 
class $
WebApplicationExtensions ,
{ 
internal 
static 
Guid 
	GetUserId "
(" #
this# '
WebApplication( 6
app7 :
): ;
{ 
var		 
httpContextAccessor		 
=		  !
app		" %
.		% &
Services		& .
.		. /
GetRequiredService		/ A
<		A B 
IHttpContextAccessor		B V
>		V W
(		W X
)		X Y
;		Y Z
var 
claim 
= 
httpContextAccessor '
.' (
HttpContext( 3
!3 4
.4 5
User5 9
.9 :
Claims: @
.@ A
FirstOrDefaultA O
(O P
xP Q
=>R T
xU V
.V W
TypeW [
==\ ^
System_ e
.e f
Securityf n
.n o
Claimso u
.u v

ClaimTypes	v Ä
.
Ä Å
NameIdentifier
Å è
)
è ê
!
ê ë
;
ë í
return 
new 
Guid 
( 
claim 
. 
Value #
)# $
;$ %
} 
internal 
static 
RouteHandlerBuilder '
CustomProduces( 6
<6 7
TOK7 :
>: ;
(; <
this< @
RouteHandlerBuilderA T
routeHandlerBuilderU h
,h i
intj m
coden r
)r s
{ 
return 
routeHandlerBuilder "
. 
Produces 
< 
TOK 
> 
( 
code 
)  
. 
Produces 
< 
ErrorDto 
> 
(  
$num  #
)# $
. 
Produces 
( 
$num 
) 
. 
Produces 
< 
ErrorDto 
> 
(  
$num  #
)# $
. 
Produces 
< 
ErrorDto 
> 
(  
$num  #
)# $
;$ %
} 
}  
\C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Common\AdressDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Common) /
;/ 0
public 
class 
	AdressDto 
{ 
public 

string 
StreetNumber 
{  
get! $
;$ %
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 

string 
Street 
{ 
get 
; 
set! $
;$ %
}& '
=( )
string* 0
.0 1
Empty1 6
;6 7
public 

string 
AddressLine1 
{  
get! $
;$ %
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 

string 
AddressLine2 
{  
get! $
;$ %
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public		 

string		 
City		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
=		& '
string		( .
.		. /
Empty		/ 4
;		4 5
public

 

string

 
ZipCode

 
{

 
get

 
;

  
set

" %
;

% &
}

' (
=

) *
string

+ 1
.

1 2
Empty

2 7
;

7 8
public 

string 
Country 
{ 
get 
;  
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

decimal 
Latitude 
{ 
get !
;! "
set$ '
;' (
}) *
public 

decimal 
	Longitude 
{ 
get "
;" #
set% (
;( )
}* +
} §
]C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Common\ContactDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Common) /
;/ 0
public 
class 

ContactDto 
{ 
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Phone 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public		 

string		 
Role		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
=		% &
string		' -
.		- .
Empty		. 3
;		3 4
}

 …
vC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\RelayPoint\Mappings\RelayPointMapperConfig.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )

RelayPoint) 3
.3 4
Mappings4 <
;< =
public		 
class		 "
RelayPointMapperConfig		 #
:		# $
	IRegister		$ -
{

 
public 

void 
Register 
( 
TypeAdapterConfig *
config+ 1
)1 2
{ 
config 
. 
	NewConfig 
< #
CreateRelayPointCommand 0
,0 1
CreateRelayPointDto2 E
>E F
(F G
)G H
; 
config 
. 
	NewConfig 
< 
GetRelayPointDto )
,) *
GetRelayPointResult+ >
>> ?
(? @
)@ A
; 
} 
} û
jC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\RelayPoint\RelayPointEndPoints.cs
	namespace

 	
GoColis


 
.

 
Shipping

 
.

 
Api

 
.

 
	Logistics

 (
.

( )

RelayPoint

) 3
;

3 4
public 
static 
class 
RelayPointEndPoints '
{ 
public 

static 
void "
MapRelayPointEndPoints -
(- .
this. 2
WebApplication3 A
appB E
)E F
{ 
app 
. 
MapPost 
( 
$str %
,% &
async 
( 
CreateRelayPointDto &
request' .
,. /
	IMediator0 9
	_mediator: C
,C D
ILoggerE L
<L M#
CreateRelayPointCommandM d
>d e
_loggerf m
,m n
IMappero v
_mapperw ~
,~ "
IHttpContextAccessor
Ä î!
httpContextAccessor
ï ®
)
® ©
=>
™ ¨
{ 
var 
command 
= 
_mapper %
.% &
Map& )
<) *#
CreateRelayPointCommand* A
>A B
(B C
requestC J
)J K
;K L
var 
result 
= 
	_mediator &
.& '
Send' +
(+ ,
command, 3
)3 4
;4 5
return 
await 
result #
.# $
Match$ )
() *
success 
=> 
Results &
.& '
Created' .
(. /
$"/ 1
$str1 A
{A B
successB I
}I J
"J K
,K L
successM T
)T U
,U V
failed 
=> 
failed $
.$ %
ToResult% -
(- .
_logger. 5
)5 6
) 
; 
} 
) 
.  
RequireAuthorization !
(! "
)" #
.   
CustomProduces   
<   
Guid    
>    !
(  ! "
$num  " %
)  % &
;  & '
app"" 
."" 
MapGet"" 
("" 
$str"" )
,"") *
async## 
(## 
Guid## 
id## 
,## 
	IMediator## %
	_mediator##& /
,##/ 0
ILogger##1 8
<##8 9
GetRelayPointQuery##9 K
>##K L
_logger##M T
,##T U
IMapper##V ]
_mapper##^ e
)##e f
=>##g i
{$$ 
var%% 
result%% 
=%% 
	_mediator%% &
.%%& '
Send%%' +
(%%+ ,
new%%, /
GetRelayPointQuery%%0 B
(%%B C
id%%C E
)%%E F
)%%F G
;%%G H
return'' 
await'' 
result'' #
.''# $
Match''$ )
('') *
success(( 
=>(( 
Results(( &
.((& '
Ok((' )
((() *
_mapper((* 1
.((1 2
Map((2 5
<((5 6
GetRelayPointDto((6 F
>((F G
(((G H
success((H O
)((O P
)((P Q
,((Q R
failed)) 
=>)) 
failed)) $
.))$ %
ToResult))% -
())- .
_logger)). 5
)))5 6
)** 
;** 
}++ 
)++ 
.,,  
RequireAuthorization,, !
(,,! "
),," #
.-- 
CustomProduces-- 
<-- 
GetRelayPointDto-- ,
>--, -
(--- .
$num--. 1
)--1 2
;--2 3
}.. 
}// ï	
zC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\RelayPoint\Requests\Create\CreateRelayPointDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )

RelayPoint) 3
.3 4
Requests4 <
.< =
Create= C
;C D
public 
class 
CreateRelayPointDto  
{ 
public 

string 
Name 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

	AdressDto 
Adress 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public		 


ContactDto		 
Contact		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
null		. 2
!		2 3
;		3 4
}

 ü

uC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\RelayPoint\Responses\Get\GetRelayPointDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )

RelayPoint) 3
.3 4
	Responses4 =
.= >
Get> A
;A B
public 
class 
GetRelayPointDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public		 

	AdressDto		 
Adress		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
=		* +
null		, 0
!		0 1
;		1 2
public

 


ContactDto

 
Contact

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
=

, -
null

. 2
!

2 3
;

3 4
} Ÿ
`C:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Shipment\Common\Dtos.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Shipment) 1
.1 2
Common2 8
;8 9
public 
record 
InsuranceDto 
( 
string 

Name 
, 
	AdressDto 
? 
Adress 
, 

ContactDto		 
?		 
Contact		 
)

 
;

 
public 
record 

PackageDto 
( 
string 

Description 
, 
string 

ExtraInformation 
, 
PackageType 
Type 
, 
decimal 

TotalPrice 
, 
	FormatDto 
Format 
, 
IEnumerable 
< 
ItemDto 
> 
Items 
) 
; 
public 
record 
	PersonDto 
( 
string 

	FirstName 
, 
string 

LastName 
, 
	AdressDto 
Adress 
, 

ContactDto 
Contact 
) 
; 
public 
record 
	FormatDto 
( 
decimal 
Weight 
, 
decimal   
Volume   
,   
decimal!! 
Height!! 
,!! 
decimal"" 
Length"" 
,"" 
decimal## 
Width## 
)## 
;## 
public%% 
record%% 
ItemDto%% 
(%% 
string&& 

Name&& 
,&& 
string'' 

Description'' 
,'' 
decimal(( 
Price(( 
,(( 
int)) 
Quantity)) 
)** 
;** ›
rC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Shipment\Mappings\ShipmentMapperConfig.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Shipment) 1
.1 2
Mappings2 :
;: ;
public		 
class		  
ShipmentMapperConfig		 !
:		" #
	IRegister		$ -
{

 
public 

void 
Register 
( 
TypeAdapterConfig *
config+ 1
)1 2
{ 
config 
. 
	NewConfig 
< 
GetShipmentDto '
,' (
GetShipmentResult) :
>: ;
(; <
)< =
; 
config 
. 
	NewConfig 
< 
COMMAND  
.  !!
CreateShipmentCommand! 6
,6 7
CreateShipmentDto8 I
>I J
(J K
)K L
; 
} 
} „
vC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Shipment\Requests\Create\CreateShipmentDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Shipment) 1
.1 2
Requests2 :
.: ;
Create; A
;A B
public 
record 
CreateShipmentDto 
(  
bool 
	IsShipper	 
, 
bool 
WithInsurance	 
, 
DateTime		 
FromPickupDate		 
,		 
DateTime

 
ToPickupDate

 
,

 
	PersonDto 
Shipper 
, 
	PersonDto 
	Recipient 
, 
InsuranceDto 
? 
	Insurance 
, 

PackageDto 
Package 
) 
; ¥	
qC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Shipment\Responses\Get\GetShipmentDto.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
.( )
Shipment) 1
.1 2
	Responses2 ;
.; <
Get< ?
;? @
public 
record 
GetShipmentDto 
( 
Guid 
Id	 
, 
bool 
IsValidated	 
, 
bool		 
IsDelivered			 
,		 
bool

 
IsDraft

	 
,

 
bool 
	IsShipper	 
, 
bool 
WithInsurance	 
, 
DateTime 
FromPickupDate 
, 
DateTime 
ToPickupDate 
, 
	PersonDto 
Shipper 
, 
	PersonDto 
	Recipient 
, 
InsuranceDto 
? 
	Insurance 
, 

PackageDto 
Package 
) 
; ˚!
fC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Logistics\Shipment\ShipmentEndPoints.cs
	namespace 	
GoColis
 
. 
Shipping 
. 
Api 
. 
	Logistics (
;( )
public 
static 
class 
ShipmentendPoints %
{ 
public 

static 
void  
MapShipmentEndPoints +
(+ ,
this, 0
WebApplication1 ?
app@ C
)C D
{ 
app 
. 
MapPost 
( 
$str $
,$ %
async 
( 
CreateShipmentDto $
request% ,
,, -
	IMediator. 7
	_mediator8 A
,A B
ILoggerC J
<J K!
CreateShipmentCommandK `
>` a
_loggerb i
,i j
IMapperk r
_mappers z
)z {
=>| ~
{ 
var 
command 
= 
_mapper %
.% &
Map& )
<) *!
CreateShipmentCommand* ?
>? @
(@ A
requestA H
)H I
;I J
command 
. 
OwnerId 
=  !
app" %
.% &
	GetUserId& /
(/ 0
)0 1
;1 2
var 
result 
= 
	_mediator &
.& '
Send' +
(+ ,
command, 3
)3 4
;4 5
return 
await 
result #
.# $
Match$ )
() *
success 
=> 
Results &
.& '
Created' .
(. /
$"/ 1
$str1 @
{@ A
successA H
}H I
"I J
,J K
successL S
)S T
,T U
failed 
=> 
failed $
.$ %
ToResult% -
(- .
_logger. 5
)5 6
) 
; 
} 
) 
.    
RequireAuthorization   !
(  ! "
$str  " .
)  . /
.!! 
CustomProduces!! 
<!! 
Guid!!  
>!!  !
(!!! "
$num!!" %
)!!% &
."" 
WithTags"" 
("" 
PermissionConstants"" )
."") *
CreateShipping""* 8
.""8 9
ToString""9 A
(""A B
)""B C
)""C D
;## 
app%% 
.%% 
MapGet%% 
(%% 
$str%% (
,%%( )
async&& 
(&& 
Guid&& 
id&& 
,&& 
	IMediator&& %
	_mediator&&& /
,&&/ 0
ILogger&&1 8
<&&8 9
GetShipmentQuery&&9 I
>&&I J
_logger&&K R
,&&R S
IMapper&&T [
_mapper&&\ c
)&&c d
=>&&e g
{'' 
var(( 
result(( 
=(( 
	_mediator(( &
.((& '
Send((' +
(((+ ,
new((, /
GetShipmentQuery((0 @
(((@ A
id((A C
,((C D
app((E H
.((H I
	GetUserId((I R
(((R S
)((S T
)((T U
)((U V
;((V W
return** 
await** 
result** #
.**# $
Match**$ )
(**) *
success++ 
=>++ 
Results++ &
.++& '
Ok++' )
(++) *
_mapper++* 1
.++1 2
Map++2 5
<++5 6
GetShipmentDto++6 D
>++D E
(++E F
success++F M
)++M N
)++N O
,++O P
failed,, 
=>,, 
failed,, $
.,,$ %
ToResult,,% -
(,,- .
_logger,,. 5
),,5 6
)-- 
;-- 
}.. 
).. 
...  
RequireAuthorization.. #
(..# $
)..$ %
.// 
CustomProduces// 
<// 
GetShipmentDto// *
>//* +
(//+ ,
$num//, /
)/// 0
;00 
}11 
}22 ê$
IC:\Developpement\GoColis\GoColis.Shipping\GoColis.Shipping.API\Program.cs
var		 
builder		 
=		 
WebApplication		 
.		 
CreateBuilder		 *
(		* +
args		+ /
)		/ 0
;		0 1
builder 
. 
Services 
. #
AddSwaggerDocumentation (
(( )
)) *
;* +
builder 
. 
Services 
. %
AddInfrastructureServices *
(* +
builder+ 2
.2 3
Configuration3 @
,@ A
builderB I
.I J
EnvironmentJ U
.U V
IsDevelopmentV c
(c d
)d e
)e f
;f g
builder 
. 
Services 
. "
AddApplicationServices '
(' (
)( )
;) *
var 
config 

= 
TypeAdapterConfig 
. 
GlobalSettings -
;- .
config 
. 
Scan 
( 
Assembly 
.  
GetExecutingAssembly )
() *
)* +
)+ ,
;, -
config 
. 
Scan 
( 
Assembly 
. 
GetAssembly  
(  !
typeof! '
(' (
GoColis( /
./ 0
Shipping0 8
.8 9
Application9 D
.D E
DependencyInjectionE X
)X Y
)Y Z
!Z [
)[ \
;\ ]
builder 
. 
Services 
. 
AddSingleton 
( 
config $
)$ %
;% &
builder 
. 
Services 
. 
	AddScoped 
< 
IMapper "
," #
ServiceMapper$ 1
>1 2
(2 3
)3 4
;4 5
builder 
. 
Services 
. 
TryAddSingleton  
<  ! 
IHttpContextAccessor! 5
,5 6
HttpContextAccessor7 J
>J K
(K L
)L M
;M N
builder 
. 
Services 
. 
AddCors 
( 
o 
=> 
o 
.  
	AddPolicy  )
() *
$str* 4
,4 5
builder6 =
=>> @
{ 
builder 
. 
AllowAnyOrigin 
( 
) 
. 
AllowAnyMethod 
( 
) 
. 
AllowAnyHeader 
( 
) 
; 
} 
) 
) 
; 
builder   
.   
Services   
.   
AddAuth   
(   
builder    
.    !
Configuration  ! .
)  . /
;  / 0
var"" 
app"" 
="" 	
builder""
 
."" 
Build"" 
("" 
)"" 
;"" 
if%% 
(%% 
app%% 
.%% 
Environment%% 
.%% 
IsDevelopment%% !
(%%! "
)%%" #
)%%# $
{&& 
app'' 
.'' #
UseSwaggerDocumentation'' 
(''  
)''  !
;''! "
}(( 
app** 
.** 
UseHttpsRedirection** 
(** 
)** 
;** 
app,, 
.,, 
UseCors,, 
(,, 
$str,, 
),, 
;,, 
app-- 
.-- 
UseAuthentication-- 
(-- 
)-- 
;-- 
app.. 
... 
UseAuthorization.. 
(.. 
).. 
;.. 
app00 
.00 
AddEndPoints00 
(00 
)00 
;00 
app22 
.22 
Services22 
.22 
CreateScope22 
(22 
)22 
.22 
MigrateDatabase22 *
(22* +
)22+ ,
;22, -
app44 
.44 
Run44 
(44 
)44 	
;44	 

public77 
partial77 
class77 
Program77 
{88 
	protected99 
Program99 
(99 
)99 
{:: 
};; 
}<< 